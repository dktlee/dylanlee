---
title: "OKC_Thunder_DSS_Project"
output: pdf_document
---
Analyst Intern, Data Science & Solutions Project
Dylan Lee
dktlee@uwaterloo.ca
(416) 312-7550

``` {r Libraries, warning = FALSE, message = FALSE}
# load required packages
library(reshape2)
library(dplyr)
library(corrplot)
library(GGally)
library(ggplot2)
library(gridExtra)
library(viridis)
library(tidyverse)
```

```{r Helper Functions}
# helper functions created to assist with resuability

##################################################################
##################   Predict All-NBA Response   ##################
##################################################################
# will predict response for data using the model given, and will return an ordered list ranking the nba players from highest probability
# of being selected as an All-NBA player to lowest
predAllNbaPlayers <- function(data, model) {
  pred <- predict(model, newdata = data, type = "response")
  all_nba_players <- data[0, ]
  all_nba_players <- data[order(pred, decreasing = TRUE), ]
  return(all_nba_players)
}

##################################################################
#####################   Calculate Accuracy   #####################
##################################################################
# will calculate the accuracy of the prediction
calcAccuracy <- function(all_nba_players) {
  correct <- all_nba_players[which(all_nba_players$TotalAllNba == 1),]
  return(dim(correct)[1] / dim(all_nba_players)[1])
}

##################################################################
###############   Leave-One-Out Cross-Validation   ###############
##################################################################
# conduct leave-one-out cross-validation by training the model on all the season's data, except one season, and leaving that one season 
# out to test the model on
cross_validation_all_nba_players <- function(data, model, position) {
  accuracies <- c()
  for (year in min(data$Season):max(data$Season)) {
    test <- data[which(data$Season == year), ]
    train <- data[which(data$Season != year), ]
    if (model$call[1] == "glm()") {
      cv.model <- glm(model$call[2],data = train,family = binomial(link = "logit"))
    } else if (model$call[1] == "lm()") {
      cv.model <- lm(model$call[2], data = train)
    }
    if (position == "guard") {
      accuracy <- calcAccuracy(predAllNbaPlayers(test, cv.model)[1:6, ])
    } else if (position == "forward") {
      accuracy <- calcAccuracy(predAllNbaPlayers(test, cv.model)[1:6, ])
    } else if (position == "center") {
      accuracy <- calcAccuracy(predAllNbaPlayers(test, cv.model)[1:3, ])
    }
    accuracies <- cbind(accuracies, accuracy)
  }
  return(accuracies)
}

##################################################################
######################   Normalize Stats   #######################
##################################################################
# normalize each statistic by dividing by that season's max
normalize_stats <- function (data) {
  for (year in levels(as.factor(data$Season))) {
    for (index in c(8:33)) {
      data_year <- data[which(data$Season == year), ]
      data[which(data$Season == year), ][, index] <- data_year[, index] / max(data_year[, index])
      data[, index] <- round(data[, index], digits = 6)
    }
  }
  return(data)
}

##################################################################
#####   Simulate Future Seasons & Predict All-NBA Players   ######
##################################################################
# this function will conduct the forecast of next year's stats, add the past season's stats to the training data set, and then predict
# All-NBA players for the forecasted season. The model is updated with each iteration when a new All-NBA team is selected
simulate_all_nba <- function(data) {
  df.forecast <- data
  for (year in 2020:2034) {
    df.temp <- forecast_next_year_stats(df.forecast[which(df.forecast$Season == (year - 1)), ],
                                        df.forecast[which(df.forecast$Season == (year - 2)), ],
                                        df.forecast[which(df.forecast$Season == (year - 3)), ])
    df.forecast <- rbind(df.forecast, df.temp)
  }
  
  df.forecast.normalize <- normalize_stats(df.forecast)
  
  for (year in 2020:2034) {
    train_guard_set <- df.forecast.normalize[which(df.forecast.normalize$Season < year & df.forecast.normalize$Pos %in% c("PG", "SG")), ]
    train_center_set <- df.forecast.normalize[which(df.forecast.normalize$Season < year & df.forecast.normalize$Pos %in% c("C")), ]
    full_model_guard <- glm(TotalAllNba ~ GP + GS + MP + Age + FGM + FGA + FGperc + ThreePM + ThreePA + ThreePperc + TwoPM + TwoPA + TwoPperc +
                                          eFGperc + FTM + FTA + FTperc + ORB + DRB + TRB + AST + STL + BLK + TOV + PF + PTS,
                            data = train_guard_set,family = binomial(link = "logit"))
    red_model_guard <- step(full_model_guard, trace = 0)
    full_model_center <- glm(TotalAllNba ~ GP + GS + MP + Age + FGM + FGA + FGperc + ThreePM + ThreePA + ThreePperc + TwoPM + TwoPA + 
                                           TwoPperc + eFGperc + FTM + FTA + FTperc + ORB + DRB + TRB + AST + STL + BLK + TOV + PF + PTS,
                             data = train_center_set,family = binomial(link = "logit"))
    red_model_center <- step(full_model_center, trace = 0)
    test_guard_set <- df.forecast.normalize[which(df.forecast.normalize$Season == year & df.forecast.normalize$Pos %in% c("PG", "SG")), ]
    test_center_set <- df.forecast.normalize[which(df.forecast.normalize$Season == year & df.forecast.normalize$Pos %in% c("C")), ]
    pred_guard <- predict(red_model_guard, newdata = test_guard_set, type = "response")
    pred_center <- predict(red_model_center, newdata = test_center_set, type = "response")
    
    if (length(pred_guard) > 0) {
      all_nba_guard <- test_guard_set[which(pred_guard >= pred_guard[order(pred_guard, decreasing = TRUE)][1:min(6, length(pred_guard))]), ]
      for (index in 1:dim(all_nba_guard)[1]) {
        player <- all_nba_guard[index, ]
        df.forecast.normalize[which(df.forecast.normalize$Player == player$Player & df.forecast.normalize$Season == year), ]$TotalAllNba <- 1
      }
    }
    if (length(pred_center) > 0) {
      all_nba_center <- test_center_set[which(pred_center >= pred_center[order(pred_center, decreasing=TRUE)][1:min(3,length(pred_center))]),]
      for (index in 1:dim(all_nba_center)[1]) {
        player <- all_nba_center[index, ]
        df.forecast.normalize[which(df.forecast.normalize$Player == player$Player & df.forecast.normalize$Season == year), ]$TotalAllNba <- 1
      }
    }
  }
  return(df.forecast.normalize)
}

##################################################################
##################   Project Next Season Stats   #################
##################################################################
# a Simple Projection System, similar to the algorithm used by Basketball-Reference.com to project a player's stats for the next season
# modified here to project a player's Total stats for the season. Not the most sophisticated projection system, but it at least generates
# comparable stats that may be used
forecast_next_year_stats <- function(last_year_data,two_years_ago_data,three_years_ago_data) {
  df <- last_year_data[0, ]
  mp_last_year <- sum(last_year_data$MP)
  mp_two_years_ago <- sum(two_years_ago_data$MP)
  mp_three_years_ago <- sum(three_years_ago_data$MP)
  fgm_last_year <- sum(last_year_data$FGM)
  fgm_two_years_ago <- sum(two_years_ago_data$FGM)
  fgm_three_years_ago <- sum(three_years_ago_data$FGM)
  fg_miss_last_year <- sum(last_year_data$FGA) - sum(last_year_data$FGM)
  fg_miss_two_years_ago <- sum(two_years_ago_data$FGA) - sum(two_years_ago_data$FGM)
  fg_miss_three_years_ago <- sum(three_years_ago_data$FGA) - sum(three_years_ago_data$FGM)
  threepm_last_year <- sum(last_year_data$ThreePM)
  threepm_two_years_ago <- sum(two_years_ago_data$ThreePM)
  threepm_three_years_ago <- sum(three_years_ago_data$ThreePM)
  threep_miss_last_year <- sum(last_year_data$ThreePA) - sum(last_year_data$ThreePM)
  threep_miss_two_years_ago <- sum(two_years_ago_data$ThreePA) - sum(two_years_ago_data$ThreePM)
  threep_miss_three_years_ago <- sum(three_years_ago_data$ThreePA) - sum(three_years_ago_data$ThreePM)
  ftm_last_year <- sum(last_year_data$FTM)
  ftm_two_years_ago <- sum(two_years_ago_data$FTM)
  ftm_three_years_ago <- sum(three_years_ago_data$FTM)
  ft_miss_last_year <- sum(last_year_data$FTA) - sum(last_year_data$FTM)
  ft_miss_two_years_ago <- sum(two_years_ago_data$FTA) - sum(two_years_ago_data$FTM)
  ft_miss_three_years_ago <- sum(three_years_ago_data$FTA) - sum(three_years_ago_data$FTM)
  orb_last_year <- sum(last_year_data$ORB)
  orb_two_years_ago <- sum(two_years_ago_data$ORB)
  orb_three_years_ago <- sum(three_years_ago_data$ORB)
  drb_last_year <- sum(last_year_data$DRB)
  drb_two_years_ago <- sum(two_years_ago_data$DRB)
  drb_three_years_ago <- sum(three_years_ago_data$DRB)
  ast_last_year <- sum(last_year_data$AST)
  ast_two_years_ago <- sum(two_years_ago_data$AST)
  ast_three_years_ago <- sum(three_years_ago_data$AST)
  stl_last_year <- sum(last_year_data$STL)
  stl_two_years_ago <- sum(two_years_ago_data$STL)
  stl_three_years_ago <- sum(three_years_ago_data$STL)
  blk_last_year <- sum(last_year_data$BLK)
  blk_two_years_ago <- sum(two_years_ago_data$BLK)
  blk_three_years_ago <- sum(three_years_ago_data$BLK)
  tov_last_year <- sum(last_year_data$TOV)
  tov_two_years_ago <- sum(two_years_ago_data$TOV)
  tov_three_years_ago <- sum(three_years_ago_data$TOV)
  pf_last_year <- sum(last_year_data$PF)
  pf_two_years_ago <- sum(two_years_ago_data$PF)
  pf_three_years_ago <- sum(three_years_ago_data$PF)
  
  for (index in 1:dim(last_year_data)[1]) {
    player <- last_year_data[index, ]
    df.player <- last_year_data[0, ]
    # stop forecasting players who have been in the league for 17 years or more
    if (player$YearsInNba < 17 & player$PTS > 0) {
      if (player$Age <= 28) {
        age_adj <- (28 - player$Age) * 0.004
      } else {
        age_adj <- (28 - player$Age) * 0.002
      }
      # add ~4 game variance noise (assumption made that players will consitently play about the same amount as the season before)
      # unfortunate for players who were injured in one of the prior years because their projections will be based
      # off the time they weren't injured and could play. However, this does capture the effect of a players durability year-to-year
      # so I am fine with making this assumption
      player_proj_gp <- max(0, round(min(82, player$GP + rnorm(1, 0, 2)), digits = 0))
      player_proj_gs <- max(0, round(min(player_proj_gp, player$GS + rnorm(1, 0, 2)), digits = 0))
      # All-NBA players play about 35 minutes per game
      player_proj_mp <- max(0, round(min(player_proj_gp * 48, player$MP + rnorm(1, 0, 2 * 35)), digits = 0))
      if (player$Player %in% three_years_ago_data$Player &
          player$Player %in% two_years_ago_data$Player &
          player$Player %in% last_year_data$Player) {
        player_mp_last_year <- last_year_data[which(last_year_data$Player == player$Player), ]$MP
        player_mp_two_years_ago <- two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$MP
        player_mp_three_years_ago <- three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$MP
        # last season weight = 6, two seasons ago weight = 3, three seasons ago weight = 1
        weighted_minutes_played <- 6 * player_mp_last_year + 3 * player_mp_two_years_ago + 1 * player_mp_three_years_ago
        weighted_fgm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$FGM + 
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$FGM +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$FGM
        weighted_fg_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM) +
                            3 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM) +
                            1 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM)
        weighted_threepm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM +
                            3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$ThreePM +
                            1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$ThreePM
        weighted_threep_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM) +
                                3 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM) +
                                1 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM)
        weighted_ftm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$FTM +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$FTM +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$FTM
        weighted_ft_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM) +
                            3 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                   last_year_data[which(last_year_data$Player == player$Player), ]$FTM) +
                            1 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                   last_year_data[which(last_year_data$Player == player$Player), ]$FTM)
        weighted_orb <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$ORB +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$ORB +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$ORB
        weighted_drb <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$DRB +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$DRB +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$DRB
        weighted_ast <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$AST +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$AST +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$AST
        weighted_stl <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$STL +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$STL +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$STL
        weighted_blk <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$BLK +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$BLK +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$BLK
        weighted_tov <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$TOV +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$TOV +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$TOV
        weighted_pf <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$PF +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$PF +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$PF
        # scaled to 1000 minutes
        league_avg_weighted_fgm <- 1000 * (6 * player_mp_last_year * (fgm_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (fgm_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (fgm_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_fg_miss <- 1000 * (6 * player_mp_last_year * (fg_miss_last_year / mp_last_year) +
                                               3 * player_mp_two_years_ago * (fg_miss_two_years_ago / mp_two_years_ago) +
                                               1 * player_mp_three_years_ago * (fg_miss_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_threepm <- 1000 * (6 * player_mp_last_year * (threepm_last_year / mp_last_year) +
                                               3 * player_mp_two_years_ago * (threepm_two_years_ago / mp_two_years_ago) +
                                               1 * player_mp_three_years_ago * (threepm_three_years_ago / mp_three_years_ago)) / 
                                            weighted_minutes_played
        league_avg_weighted_threep_miss <- 1000 * (6 * player_mp_last_year * (threep_miss_last_year / mp_last_year) +
                                                   3 * player_mp_two_years_ago * (threep_miss_two_years_ago / mp_two_years_ago) +
                                                   1 * player_mp_three_years_ago * (threep_miss_three_years_ago / mp_three_years_ago)) / 
                                                  weighted_minutes_played
        league_avg_weighted_ftm <- 1000 * (6 * player_mp_last_year * (ftm_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (ftm_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (ftm_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_ft_miss <- 1000 * (6 * player_mp_last_year * (ft_miss_last_year / mp_last_year) +
                                               3 * player_mp_two_years_ago * (ft_miss_two_years_ago / mp_two_years_ago) +
                                               1 * player_mp_three_years_ago * (ft_miss_three_years_ago / mp_three_years_ago)) / 
                                            weighted_minutes_played
        league_avg_weighted_orb <- 1000 * (6 * player_mp_last_year * (orb_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (orb_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (orb_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_drb <- 1000 * (6 * player_mp_last_year * (drb_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (drb_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (drb_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_ast <- 1000 * (6 * player_mp_last_year * (ast_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (ast_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (ast_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_stl <- 1000 * (6 * player_mp_last_year * (stl_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (stl_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (stl_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_blk <- 1000 * (6 * player_mp_last_year * (blk_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (blk_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (blk_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_tov <- 1000 * (6 * player_mp_last_year * (tov_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (tov_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (tov_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_pf <- 1000 * (6 * player_mp_last_year * (pf_last_year / mp_last_year) +
                                          3 * player_mp_two_years_ago * (pf_two_years_ago / mp_two_years_ago) +
                                          1 * player_mp_three_years_ago * (pf_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        player_proj_fgm <- round((weighted_fgm + league_avg_weighted_fgm) / (weighted_minutes_played +1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_fg_miss <- round((weighted_fg_miss + league_avg_weighted_fg_miss) / (weighted_minutes_played + 1000) * 
                                       player_proj_mp * (1 - age_adj),digits = 0)
        player_proj_threepm <- round((weighted_threepm + league_avg_weighted_threepm) / (weighted_minutes_played + 1000) * 
                                       player_proj_mp * (1 + age_adj),digits = 0)
        player_proj_threep_miss <- round((weighted_threep_miss + league_avg_weighted_threep_miss) / (weighted_minutes_played + 1000) * 
                                           player_proj_mp * (1 - age_adj),digits = 0)
        player_proj_ftm <- round((weighted_ftm + league_avg_weighted_ftm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_ft_miss <- round((weighted_ft_miss + league_avg_weighted_ft_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                       (1 - age_adj),digits = 0)
        player_proj_orb <- round((weighted_orb + league_avg_weighted_orb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_drb <- round((weighted_fgm + league_avg_weighted_drb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_trb <- player_proj_orb + player_proj_drb
        player_proj_ast <- round((weighted_ast + league_avg_weighted_ast) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_stl <- round((weighted_stl + league_avg_weighted_stl) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                  digits = 0)
        player_proj_blk <- round((weighted_blk + league_avg_weighted_blk) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_tov <- round((weighted_tov + league_avg_weighted_tov) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                 digits = 0)
        player_proj_pf <- round((weighted_pf + league_avg_weighted_pf) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                digits = 0)
        player_proj_fga <- player_proj_fgm + player_proj_fg_miss
        player_proj_fgperc <- ifelse(player_proj_fga == 0,0,round(player_proj_fgm / player_proj_fga, digits = 3))
        player_proj_threepa <- player_proj_threepm + player_proj_threep_miss
        player_proj_threepperc <- ifelse(player_proj_threepa == 0,0,round(player_proj_threepm / player_proj_threepa, digits = 3))
        player_proj_fta <- player_proj_ftm + player_proj_ft_miss
        player_proj_ftperc <- ifelse(player_proj_fta == 0,0,round(player_proj_ftm / player_proj_fta, digits = 3))
        player_proj_twopm <- player_proj_fgm - player_proj_threepm
        player_proj_twopa <- player_proj_fga - player_proj_threepa
        player_proj_twopperc <- ifelse(player_proj_twopa == 0,0,round(player_proj_twopm / player_proj_twopa, digits = 3))
        player_proj_efgperc <- ifelse(player_proj_fga == 0,0,round((player_proj_fgm + 0.5 * player_proj_threepm) / player_proj_fga,
                                                                   digits = 3))
        player_proj_pts <- 3 * player_proj_threepm + 2 * player_proj_twopm + 1 * player_proj_ftm
      } else if (player$Player %in% two_years_ago_data$Player &
                 player$Player %in% last_year_data$Player &
                 !(player$Player %in% three_years_ago_data$Player)) {
        player_mp_last_year <- last_year_data[which(last_year_data$Player == player$Player), ]$MP
        player_mp_two_years_ago <- two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$MP
        # last season weight = 6, two seasons ago weight = 3
        weighted_minutes_played <- 6 * player_mp_last_year + 3 * player_mp_two_years_ago
        weighted_fgm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$FGM +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$FGM
        weighted_fg_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM) +
                            3 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                   last_year_data[which(last_year_data$Player == player$Player), ]$FGM)
        weighted_threepm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM +
                            3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$ThreePM
        weighted_threep_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM) +
                                3 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM)
        weighted_ftm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$FTM +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$FTM
        weighted_ft_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM) +
                            3 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM)
        weighted_orb <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$ORB +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$ORB
        weighted_drb <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$DRB +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$DRB
        weighted_ast <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$AST +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$AST
        weighted_stl <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$STL +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$STL
        weighted_blk <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$BLK +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$BLK
        weighted_tov <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$TOV +
                        3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$TOV
        weighted_pf <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$PF +
                       3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$PF
        # scaled to 1000 minutes
        league_avg_weighted_fgm <- 1000 * (6 * player_mp_last_year * (fgm_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (fgm_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_fg_miss <- 1000 * (6 * player_mp_last_year * (fg_miss_last_year / mp_last_year) +
                                               3 * player_mp_two_years_ago * (fg_miss_two_years_ago / mp_two_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_threepm <- 1000 * (6 * player_mp_last_year * (threepm_last_year / mp_last_year) +
                                               3 * player_mp_two_years_ago * (threepm_two_years_ago / mp_two_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_threep_miss <- 1000 * (6 * player_mp_last_year * (threep_miss_last_year / mp_last_year) +
                                                   3 * player_mp_two_years_ago * (threep_miss_two_years_ago / mp_two_years_ago)) /
                                                weighted_minutes_played
        league_avg_weighted_ftm <- 1000 * (6 * player_mp_last_year * (ftm_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (ftm_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_ft_miss <- 1000 * (6 * player_mp_last_year * (ft_miss_last_year / mp_last_year) +
                                               3 * player_mp_two_years_ago * (ft_miss_two_years_ago / mp_two_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_orb <- 1000 * (6 * player_mp_last_year * (orb_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (orb_two_years_ago /mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_drb <- 1000 * (6 * player_mp_last_year * (drb_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (drb_two_years_ago /mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_ast <- 1000 * (6 * player_mp_last_year * (ast_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (ast_two_years_ago /mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_stl <- 1000 * (6 * player_mp_last_year * (stl_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (stl_two_years_ago /mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_blk <- 1000 * (6 * player_mp_last_year * (blk_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (blk_two_years_ago /mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_tov <- 1000 * (6 * player_mp_last_year * (tov_last_year / mp_last_year) +
                                           3 * player_mp_two_years_ago * (tov_two_years_ago /mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_pf <- 1000 * (6 * player_mp_last_year * (pf_last_year / mp_last_year) +
                                          3 * player_mp_two_years_ago * (pf_two_years_ago /mp_two_years_ago)) / weighted_minutes_played
        player_proj_fgm <- round((weighted_fgm + league_avg_weighted_fgm) / (weighted_minutes_played +1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_fg_miss <- round((weighted_fg_miss + league_avg_weighted_fg_miss) / (weighted_minutes_played +1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_threepm <- round((weighted_threepm + league_avg_weighted_threepm) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 + age_adj),digits = 0)
        player_proj_threep_miss <- round((weighted_threep_miss + league_avg_weighted_threep_miss) / (weighted_minutes_played + 1000) * 
                                         player_proj_mp * (1 - age_adj),digits = 0)
        player_proj_ftm <- round((weighted_ftm + league_avg_weighted_ftm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_ft_miss <- round((weighted_ft_miss + league_avg_weighted_ft_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_orb <- round((weighted_orb + league_avg_weighted_orb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_drb <- round((weighted_fgm + league_avg_weighted_drb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_trb <- player_proj_orb + player_proj_drb
        player_proj_ast <- round((weighted_ast + league_avg_weighted_ast) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_stl <- round((weighted_stl + league_avg_weighted_stl) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_blk <- round((weighted_blk + league_avg_weighted_blk) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_tov <- round((weighted_tov + league_avg_weighted_tov) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                 digits = 0)
        player_proj_pf <- round((weighted_pf + league_avg_weighted_pf) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                digits = 0)
        player_proj_fga <- player_proj_fgm + player_proj_fg_miss
        player_proj_fgperc <- ifelse(player_proj_fga == 0,0,round(player_proj_fgm / player_proj_fga, digits = 3))
        player_proj_threepa <- player_proj_threepm + player_proj_threep_miss
        player_proj_threepperc <- ifelse(player_proj_threepa == 0,0,round(player_proj_threepm / player_proj_threepa, digits = 3))
        player_proj_fta <- player_proj_ftm + player_proj_ft_miss
        player_proj_ftperc <- ifelse(player_proj_fta == 0,0,round(player_proj_ftm / player_proj_fta, digits = 3))
        player_proj_twopm <- player_proj_fgm - player_proj_threepm
        player_proj_twopa <- player_proj_fga - player_proj_threepa
        player_proj_twopperc <- ifelse(player_proj_twopa == 0,0,round(player_proj_twopm / player_proj_twopa, digits = 3))
        player_proj_efgperc <- ifelse(player_proj_fga == 0,0,round((player_proj_fgm + 0.5 * player_proj_threepm) / player_proj_fga, digits = 3))
        player_proj_pts <- 3 * player_proj_threepm + 2 * player_proj_twopm + 1 * player_proj_ftm
      } else if (player$Player %in% last_year_data$Player &
                 !(player$Player %in% two_years_ago_data$Player) &
                 !(player$Player %in% three_years_ago_data$Player)) {
        player_mp_last_year <- last_year_data[which(last_year_data$Player == player$Player), ]$MP
        # last season weight = 6, two seasons ago weight = 3
        weighted_minutes_played <- 6 * player_mp_last_year
        weighted_fgm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$FGM
        weighted_fg_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM)
        weighted_threepm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM
        weighted_threep_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM)
        weighted_ftm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$FTM
        weighted_ft_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM)
        weighted_orb <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$ORB
        weighted_drb <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$DRB
        weighted_ast <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$AST
        weighted_stl <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$STL
        weighted_blk <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$BLK
        weighted_tov <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$TOV
        weighted_pf <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$PF
        # scaled to 1000 minutes
        league_avg_weighted_fgm <- 1000 * (6 * player_mp_last_year * (fgm_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_fg_miss <- 1000 * (6 * player_mp_last_year * (fg_miss_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_threepm <- 1000 * (6 * player_mp_last_year * (threepm_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_threep_miss <- 1000 * (6 * player_mp_last_year * (threep_miss_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_ftm <- 1000 * (6 * player_mp_last_year * (ftm_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_ft_miss <- 1000 * (6 * player_mp_last_year * (ft_miss_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_orb <- 1000 * (6 * player_mp_last_year * (orb_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_drb <- 1000 * (6 * player_mp_last_year * (drb_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_ast <- 1000 * (6 * player_mp_last_year * (ast_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_stl <- 1000 * (6 * player_mp_last_year * (stl_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_blk <- 1000 * (6 * player_mp_last_year * (blk_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_tov <- 1000 * (6 * player_mp_last_year * (tov_last_year / mp_last_year)) / weighted_minutes_played
        league_avg_weighted_pf <- 1000 * (6 * player_mp_last_year * (pf_last_year / mp_last_year)) / weighted_minutes_played
        # For the following categories the sign of the age adjustment is reversed:
        # field goals missed, 3-point field goals missed, free throws missed, turnovers, and personal fouls
        # For the shooting categories, shots missed are projected rather than shots attempted
        # Projected shots attempted are then computed by adding projected shots made and projected shots missed
        player_proj_fgm <- round((weighted_fgm + league_avg_weighted_fgm) / (weighted_minutes_played +1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_fg_miss <- round((weighted_fg_miss + league_avg_weighted_fg_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_threepm <- round((weighted_threepm + league_avg_weighted_threepm) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 + age_adj),digits = 0)
        player_proj_threep_miss <- round((weighted_threep_miss + league_avg_weighted_threep_miss) / (weighted_minutes_played + 1000) *
                                         player_proj_mp * (1 - age_adj),digits = 0)
        player_proj_ftm <- round((weighted_ftm + league_avg_weighted_ftm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_ft_miss <- round((weighted_ft_miss + league_avg_weighted_ft_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_orb <- round((weighted_orb + league_avg_weighted_orb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_drb <- round((weighted_fgm + league_avg_weighted_drb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_trb <- player_proj_orb + player_proj_drb
        player_proj_ast <- round((weighted_ast + league_avg_weighted_ast) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_stl <- round((weighted_stl + league_avg_weighted_stl) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_blk <- round((weighted_blk + league_avg_weighted_blk) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_tov <- round((weighted_tov + league_avg_weighted_tov) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                 digits = 0)
        player_proj_pf <- round((weighted_pf + league_avg_weighted_pf) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                digits = 0)
        player_proj_fga <- player_proj_fgm + player_proj_fg_miss
        player_proj_fgperc <- ifelse(player_proj_fga == 0,0,round(player_proj_fgm / player_proj_fga, digits = 3))
        player_proj_threepa <- player_proj_threepm + player_proj_threep_miss
        player_proj_threepperc <- ifelse(player_proj_threepa == 0,0,round(player_proj_threepm / player_proj_threepa, digits = 3))
        player_proj_fta <- player_proj_ftm + player_proj_ft_miss
        player_proj_ftperc <- ifelse(player_proj_fta == 0,0,round(player_proj_ftm / player_proj_fta, digits = 3))
        player_proj_twopm <- player_proj_fgm - player_proj_threepm
        player_proj_twopa <- player_proj_fga - player_proj_threepa
        player_proj_twopperc <- round(player_proj_twopm / player_proj_twopa, 3)
        player_proj_efgperc <- ifelse(player_proj_fga == 0,0,round((player_proj_fgm + 0.5 * player_proj_threepm) / player_proj_fga,digits = 3))
        # Projected points are computed using projected field goals made, projected 3-point field goals made, and projected free throws made
        player_proj_pts <- 3 * player_proj_threepm + 2 * player_proj_twopm + 1 * player_proj_ftm
      } else if (player$Player %in% three_years_ago_data$Player &
                 player$Player %in% last_year_data$Player &
                 !(player$Player %in% two_years_ago_data$Player)) {
        player_mp_last_year <- last_year_data[which(last_year_data$Player == player$Player), ]$MP
        player_mp_three_years_ago <- three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$MP
        # last season weight = 6, two seasons ago weight = 3, three seasons ago weight = 1
        weighted_minutes_played <- 6 * player_mp_last_year + 1 * player_mp_three_years_ago
        weighted_fgm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$FGM +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$FGM
        weighted_fg_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM) +
                            1 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM)
        weighted_threepm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM +
                            1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$ThreePM
        weighted_threep_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM) +
                                1 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM)
        weighted_ftm <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$FTM +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$FTM
        weighted_ft_miss <- 6 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM) +
                            1 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM)
        weighted_orb <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$ORB +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$ORB
        weighted_drb <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$DRB +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$DRB
        weighted_ast <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$AST +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$AST
        weighted_stl <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$STL +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$STL
        weighted_blk <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$BLK +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$BLK
        weighted_tov <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$TOV +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$TOV
        weighted_pf <- 6 * last_year_data[which(last_year_data$Player == player$Player), ]$PF +
                       1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$PF
        # scaled to 1000 minutes
        league_avg_weighted_fgm <- 1000 * (6 * player_mp_last_year * (fgm_last_year / mp_last_year) +
                                           1 * player_mp_three_years_ago * (fgm_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_fg_miss <- 1000 * (6 * player_mp_last_year * (fg_miss_last_year / mp_last_year) +
                                               1 * player_mp_three_years_ago * (fg_miss_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_threepm <- 1000 * (6 * player_mp_last_year * (threepm_last_year / mp_last_year) +
                                               1 * player_mp_three_years_ago * (threepm_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_threep_miss <- 1000 * (6 * player_mp_last_year * (threep_miss_last_year / mp_last_year) +
                                                   1 * player_mp_three_years_ago * (threep_miss_three_years_ago / mp_three_years_ago)) /
                                                weighted_minutes_played
        league_avg_weighted_ftm <- 1000 * (6 * player_mp_last_year * (ftm_last_year / mp_last_year) +
                                           1 * player_mp_three_years_ago * (ftm_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_ft_miss <- 1000 * (6 * player_mp_last_year * (ft_miss_last_year / mp_last_year) +
                                               1 * player_mp_three_years_ago * (ft_miss_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_orb <- 1000 * (6 * player_mp_last_year * (orb_last_year / mp_last_year) +
                                           1 * player_mp_three_years_ago * (orb_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_drb <- 1000 * (6 * player_mp_last_year * (drb_last_year / mp_last_year) +
                                           1 * player_mp_three_years_ago * (drb_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_ast <- 1000 * (6 * player_mp_last_year * (ast_last_year / mp_last_year) +
                                           1 * player_mp_three_years_ago * (ast_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_stl <- 1000 * (6 * player_mp_last_year * (stl_last_year / mp_last_year) +
                                           1 * player_mp_three_years_ago * (stl_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_blk <- 1000 * (6 * player_mp_last_year * (blk_last_year / mp_last_year) +
                                           1 * player_mp_three_years_ago * (blk_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_tov <- 1000 * (6 * player_mp_last_year * (tov_last_year / mp_last_year) +
                                           1 * player_mp_three_years_ago * (tov_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_pf <- 1000 * (6 * player_mp_last_year * (pf_last_year / mp_last_year) +
                                          1 * player_mp_three_years_ago * (pf_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        player_proj_fgm <- round((weighted_fgm + league_avg_weighted_fgm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_fg_miss <- round((weighted_fg_miss + league_avg_weighted_fg_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_threepm <- round((weighted_threepm + league_avg_weighted_threepm) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 + age_adj),digits = 0)
        player_proj_threep_miss <- round((weighted_threep_miss + league_avg_weighted_threep_miss) / (weighted_minutes_played + 1000) *
                                         player_proj_mp * (1 - age_adj),digits = 0)
        player_proj_ftm <- round((weighted_ftm + league_avg_weighted_ftm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_ft_miss <- round((weighted_ft_miss + league_avg_weighted_ft_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_orb <- round((weighted_orb + league_avg_weighted_orb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_drb <- round((weighted_fgm + league_avg_weighted_drb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_trb <- player_proj_orb + player_proj_drb
        player_proj_ast <- round((weighted_ast + league_avg_weighted_ast) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_stl <- round((weighted_stl + league_avg_weighted_stl) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_blk <- round((weighted_blk + league_avg_weighted_blk) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_tov <- round((weighted_tov + league_avg_weighted_tov) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                 digits = 0)
        player_proj_pf <- round((weighted_pf + league_avg_weighted_pf) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                digits = 0)
        player_proj_fga <- player_proj_fgm + player_proj_fg_miss
        player_proj_fgperc <- ifelse(player_proj_fga == 0,0,round(player_proj_fgm / player_proj_fga, digits = 3))
        player_proj_threepa <- player_proj_threepm + player_proj_threep_miss
        player_proj_threepperc <- ifelse(player_proj_threepa == 0,0,round(player_proj_threepm / player_proj_threepa, digits = 3))
        player_proj_fta <- player_proj_ftm + player_proj_ft_miss
        player_proj_ftperc <- ifelse(player_proj_fta == 0,0,round(player_proj_ftm / player_proj_fta, digits = 3))
        player_proj_twopm <- player_proj_fgm - player_proj_threepm
        player_proj_twopa <- player_proj_fga - player_proj_threepa
        player_proj_twopperc <- ifelse(player_proj_twopa == 0,0,round(player_proj_twopm / player_proj_twopa, digits = 3))
        player_proj_efgperc <- ifelse(player_proj_fga == 0,0,round((player_proj_fgm + 0.5 * player_proj_threepm) / player_proj_fga,digits = 3))
        player_proj_pts <- 3 * player_proj_threepm + 2 * player_proj_twopm + 1 * player_proj_ftm
      } else if (player$Player %in% three_years_ago_data$Player &
                 player$Player %in% two_years_ago_data$Player &
                 !(player$Player %in% last_year_data$Player)) {
        player_mp_two_years_ago <- two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$MP
        player_mp_three_years_ago <- three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$MP
        # last season weight = 6, two seasons ago weight = 3, three seasons ago weight = 1
        weighted_minutes_played <- 3 * player_mp_two_years_ago + 1 * player_mp_three_years_ago
        weighted_fgm <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$FGM +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$FGM
        weighted_fg_miss <-3 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                last_year_data[which(last_year_data$Player == player$Player), ]$FGM) +
                           1 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                last_year_data[which(last_year_data$Player == player$Player), ]$FGM)
        weighted_threepm <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$ThreePM +
                            1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$ThreePM
        weighted_threep_miss <- 3 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM) +
                                1 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM)
        weighted_ftm <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$FTM +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$FTM
        weighted_ft_miss <- 3 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM) +
                            1 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM)
        weighted_orb <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$ORB +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$ORB
        weighted_drb <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$DRB +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$DRB
        weighted_ast <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$AST +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$AST
        weighted_stl <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$STL +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$STL
        weighted_blk <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$BLK +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$BLK
        weighted_tov <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$TOV +
                        1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$TOV
        weighted_pf <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$PF +
                       1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$PF
        # scaled to 1000 minutes
        league_avg_weighted_fgm <- 1000 * (3 * player_mp_two_years_ago * (fgm_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (fgm_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_fg_miss <- 1000 * (3 * player_mp_two_years_ago * (fg_miss_two_years_ago / mp_two_years_ago) +
                                               1 * player_mp_three_years_ago * (fg_miss_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_threepm <- 1000 * (3 * player_mp_two_years_ago * (threepm_two_years_ago / mp_two_years_ago) +
                                               1 * player_mp_three_years_ago * (threepm_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_threep_miss <- 1000 * (3 * player_mp_two_years_ago * (threep_miss_two_years_ago / mp_two_years_ago) +
                                                   1 * player_mp_three_years_ago * (threep_miss_three_years_ago / mp_three_years_ago)) /
                                                weighted_minutes_played
        league_avg_weighted_ftm <- 1000 * (3 * player_mp_two_years_ago * (ftm_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (ftm_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_ft_miss <- 1000 * (3 * player_mp_two_years_ago * (ft_miss_two_years_ago / mp_two_years_ago) +
                                               1 * player_mp_three_years_ago * (ft_miss_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_orb <- 1000 * (3 * player_mp_two_years_ago * (orb_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (orb_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_drb <- 1000 * (3 * player_mp_two_years_ago * (drb_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (drb_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_ast <- 1000 * (3 * player_mp_two_years_ago * (ast_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (ast_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_stl <- 1000 * (3 * player_mp_two_years_ago * (stl_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (stl_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_blk <- 1000 * (3 * player_mp_two_years_ago * (blk_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (blk_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_tov <- 1000 * (3 * player_mp_two_years_ago * (tov_two_years_ago / mp_two_years_ago) +
                                           1 * player_mp_three_years_ago * (tov_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_pf <- 1000 * (3 * player_mp_two_years_ago * (pf_two_years_ago / mp_two_years_ago) +
                                          1 * player_mp_three_years_ago * (pf_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        player_proj_fgm <- round((weighted_fgm + league_avg_weighted_fgm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_fg_miss <- round((weighted_fg_miss + league_avg_weighted_fg_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_threepm <- round((weighted_threepm + league_avg_weighted_threepm) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 + age_adj),digits = 0)
        player_proj_threep_miss <- round((weighted_threep_miss + league_avg_weighted_threep_miss) / (weighted_minutes_played + 1000) *
                                         player_proj_mp * (1 - age_adj),digits = 0)
        player_proj_ftm <- round((weighted_ftm + league_avg_weighted_ftm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_ft_miss <- round((weighted_ft_miss + league_avg_weighted_ft_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_orb <- round((weighted_orb + league_avg_weighted_orb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_drb <- round((weighted_fgm + league_avg_weighted_drb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                  digits = 0 )
        player_proj_trb <- player_proj_orb + player_proj_drb
        player_proj_ast <- round((weighted_ast + league_avg_weighted_ast) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_stl <- round((weighted_stl + league_avg_weighted_stl) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_blk <- round((weighted_blk + league_avg_weighted_blk) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_tov <- round((weighted_tov + league_avg_weighted_tov) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                 digits = 0)
        player_proj_pf <- round((weighted_pf + league_avg_weighted_pf) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                digits = 0)
        player_proj_fga <- player_proj_fgm + player_proj_fg_miss
        player_proj_fgperc <- ifelse(player_proj_fga == 0,0,round(player_proj_fgm / player_proj_fga, digits = 3))
        player_proj_threepa <- player_proj_threepm + player_proj_threep_miss
        player_proj_threepperc <- ifelse(player_proj_threepa == 0,0,round(player_proj_threepm / player_proj_threepa, digits = 3))
        player_proj_fta <- player_proj_ftm + player_proj_ft_miss
        player_proj_ftperc <- ifelse(player_proj_fta == 0,0,round(player_proj_ftm / player_proj_fta, digits = 3))
        player_proj_twopm <- player_proj_fgm - player_proj_threepm
        player_proj_twopa <- player_proj_fga - player_proj_threepa
        player_proj_twopperc <- ifelse(player_proj_twopa == 0,0,round(player_proj_twopm / player_proj_twopa, digits = 3))
        player_proj_efgperc <- ifelse(player_proj_fga == 0,0,round((player_proj_fgm + 0.5 * player_proj_threepm) / player_proj_fga,digits = 3))
        player_proj_pts <- 3 * player_proj_threepm + 2 * player_proj_twopm + 1 * player_proj_ftm
      } else if (player$Player %in% two_years_ago_data$Player &
                 !(player$Player %in% last_year_data$Player) &
                 !(player$Player %in% three_years_ago_data$Player)) {
        player_mp_two_years_ago <- two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$MP
        # last season weight = 6, two seasons ago weight = 3, three seasons ago weight = 1
        weighted_minutes_played <- 3 * player_mp_two_years_ago
        weighted_fgm <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$FGM
        weighted_fg_miss <- 3 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM)
        weighted_threepm <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$ThreePM
        weighted_threep_miss <- 3 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM)
        weighted_ftm <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$FTM
        weighted_ft_miss <- 3 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM)
        weighted_orb <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$ORB
        weighted_drb <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$DRB
        weighted_ast <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$AST
        weighted_stl <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$STL
        weighted_blk <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$BLK
        weighted_tov <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$TOV
        weighted_pf <- 3 * two_years_ago_data[which(two_years_ago_data$Player == player$Player), ]$PF
        # scaled to 1000 minutes
        league_avg_weighted_fgm <- 1000 * (3 * player_mp_two_years_ago * (fgm_two_years_ago / mp_two_years_ago))/weighted_minutes_played
        league_avg_weighted_fg_miss <- 1000 * (3 * player_mp_two_years_ago * (fg_miss_two_years_ago / mp_two_years_ago))/weighted_minutes_played
        league_avg_weighted_threepm <- 1000 * (3 * player_mp_two_years_ago * (threepm_two_years_ago / mp_two_years_ago)) /weighted_minutes_played
        league_avg_weighted_threep_miss <- 1000 * (3 * player_mp_two_years_ago * (threep_miss_two_years_ago / mp_two_years_ago)) / 
                                                weighted_minutes_played
        league_avg_weighted_ftm <- 1000 * (3 * player_mp_two_years_ago * (ftm_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_ft_miss <- 1000 * (3 * player_mp_two_years_ago * (ft_miss_two_years_ago / mp_two_years_ago)) /weighted_minutes_played
        league_avg_weighted_orb <- 1000 * (3 * player_mp_two_years_ago * (orb_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_drb <- 1000 * (3 * player_mp_two_years_ago * (drb_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_ast <- 1000 * (3 * player_mp_two_years_ago * (ast_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_stl <- 1000 * (3 * player_mp_two_years_ago * (stl_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_blk <- 1000 * (3 * player_mp_two_years_ago * (blk_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_tov <- 1000 * (3 * player_mp_two_years_ago * (tov_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        league_avg_weighted_pf <- 1000 * (3 * player_mp_two_years_ago * (pf_two_years_ago / mp_two_years_ago)) / weighted_minutes_played
        player_proj_fgm <- round((weighted_fgm + league_avg_weighted_fgm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_fg_miss <- round((weighted_fg_miss + league_avg_weighted_fg_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_threepm <- round((weighted_threepm + league_avg_weighted_threepm) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 + age_adj),digits = 0)
        player_proj_threep_miss <- round((weighted_threep_miss + league_avg_weighted_threep_miss) / (weighted_minutes_played + 1000) *
                                         player_proj_mp * (1 - age_adj),digits = 0)
        player_proj_ftm <- round((weighted_ftm + league_avg_weighted_ftm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_ft_miss <- round((weighted_ft_miss + league_avg_weighted_ft_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_orb <- round((weighted_orb + league_avg_weighted_orb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_drb <- round((weighted_fgm + league_avg_weighted_drb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_trb <- player_proj_orb + player_proj_drb
        player_proj_ast <- round((weighted_ast + league_avg_weighted_ast) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_stl <- round((weighted_stl + league_avg_weighted_stl) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_blk <- round((weighted_blk + league_avg_weighted_blk) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_tov <- round((weighted_tov + league_avg_weighted_tov) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                 digits = 0)
        player_proj_pf <- round((weighted_pf + league_avg_weighted_pf) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                digits = 0)
        player_proj_fga <- player_proj_fgm + player_proj_fg_miss
        player_proj_fgperc <- ifelse(player_proj_fga == 0,0,round(player_proj_fgm / player_proj_fga, digits = 3))
        player_proj_threepa <- player_proj_threepm + player_proj_threep_miss
        player_proj_threepperc <- ifelse(player_proj_threepa == 0,0,round(player_proj_threepm / player_proj_threepa, digits = 3))
        player_proj_fta <- player_proj_ftm + player_proj_ft_miss
        player_proj_ftperc <- ifelse(player_proj_fta == 0,0,round(player_proj_ftm / player_proj_fta, digits = 3))
        player_proj_twopm <- player_proj_fgm - player_proj_threepm
        player_proj_twopa <- player_proj_fga - player_proj_threepa
        player_proj_twopperc <- ifelse(player_proj_twopa == 0,0,round(player_proj_twopm / player_proj_twopa, digits = 3))
        player_proj_efgperc <- ifelse(player_proj_fga == 0,0,round((player_proj_fgm + 0.5 * player_proj_threepm) / player_proj_fga,digits = 3))
        player_proj_pts <- 3 * player_proj_threepm + 2 * player_proj_twopm + 1 * player_proj_ftm
      } else if (player$Player %in% three_years_ago_data$Player &
                 !(player$Player %in% last_year_data$Player) &
                 !(player$Player %in% two_years_ago_data$Player)) {
        player_mp_three_years_ago <- three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$MP
        # last season weight = 6, two seasons ago weight = 3, three seasons ago weight = 1
        weighted_minutes_played <- 1 * player_mp_three_years_ago
        weighted_fgm <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$FGM
        weighted_fg_miss <- 1 * (last_year_data[which(last_year_data$Player == player$Player), ]$FGA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FGM)
        weighted_threepm <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$ThreePM
        weighted_threep_miss <- 1 * (last_year_data[which(last_year_data$Player == player$Player), ]$ThreePA -
                                     last_year_data[which(last_year_data$Player == player$Player), ]$ThreePM)
        weighted_ftm <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$FTM
        weighted_ft_miss <- 1 * (last_year_data[which(last_year_data$Player == player$Player), ]$FTA -
                                 last_year_data[which(last_year_data$Player == player$Player), ]$FTM)
        weighted_orb <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$ORB
        weighted_drb <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$DRB
        weighted_ast <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$AST
        weighted_stl <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$STL
        weighted_blk <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$BLK
        weighted_tov <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$TOV
        weighted_pf <- 1 * three_years_ago_data[which(three_years_ago_data$Player == player$Player), ]$PF
        # scaled to 1000 minutes
        league_avg_weighted_fgm <- 1000 * (1 * player_mp_three_years_ago * (fgm_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_fg_miss <- 1000 * (1 * player_mp_three_years_ago * (fg_miss_three_years_ago / mp_three_years_ago)) / 
                                            weighted_minutes_played
        league_avg_weighted_threepm <- 1000 * (1 * player_mp_three_years_ago * (threepm_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_threep_miss <- 1000 * (1 * player_mp_three_years_ago * (threep_miss_three_years_ago / mp_three_years_ago)) /
                                                weighted_minutes_played
        league_avg_weighted_ftm <- 1000 * (1 * player_mp_three_years_ago * (ftm_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_ft_miss <- 1000 * (1 * player_mp_three_years_ago * (ft_miss_three_years_ago / mp_three_years_ago)) /
                                            weighted_minutes_played
        league_avg_weighted_orb <- 1000 * (1 * player_mp_three_years_ago * (orb_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_drb <- 1000 * (1 * player_mp_three_years_ago * (drb_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_ast <- 1000 * (1 * player_mp_three_years_ago * (ast_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_stl <- 1000 * (1 * player_mp_three_years_ago * (stl_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_blk <- 1000 * (1 * player_mp_three_years_ago * (blk_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_tov <- 1000 * (1 * player_mp_three_years_ago * (tov_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        league_avg_weighted_pf <- 1000 * (1 * player_mp_three_years_ago * (pf_three_years_ago / mp_three_years_ago)) / weighted_minutes_played
        player_proj_fgm <- round((weighted_fgm + league_avg_weighted_fgm) / (weighted_minutes_played +1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_fg_miss <- round((weighted_fg_miss + league_avg_weighted_fg_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_threepm <- round((weighted_threepm + league_avg_weighted_threepm) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 + age_adj),digits = 0)
        player_proj_threep_miss <- round((weighted_threep_miss + league_avg_weighted_threep_miss) / (weighted_minutes_played + 1000) *
                                         player_proj_mp * (1 - age_adj),digits = 0)
        player_proj_ftm <- round((weighted_ftm + league_avg_weighted_ftm) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_ft_miss <- round((weighted_ft_miss + league_avg_weighted_ft_miss) / (weighted_minutes_played + 1000) * player_proj_mp * 
                                     (1 - age_adj),digits = 0)
        player_proj_orb <- round((weighted_orb + league_avg_weighted_orb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_drb <- round((weighted_fgm + league_avg_weighted_drb) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_trb <- player_proj_orb + player_proj_drb
        player_proj_ast <- round((weighted_ast + league_avg_weighted_ast) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_stl <- round((weighted_stl + league_avg_weighted_stl) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_blk <- round((weighted_blk + league_avg_weighted_blk) / (weighted_minutes_played + 1000) * player_proj_mp * (1 + age_adj),
                                 digits = 0)
        player_proj_tov <- round((weighted_tov + league_avg_weighted_tov) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                 digits = 0)
        player_proj_pf <- round((weighted_pf + league_avg_weighted_pf) / (weighted_minutes_played + 1000) * player_proj_mp * (1 - age_adj),
                                digits = 0)
        player_proj_fga <- player_proj_fgm + player_proj_fg_miss
        player_proj_fgperc <- ifelse(player_proj_fga == 0,0,round(player_proj_fgm / player_proj_fga, digits = 3))
        player_proj_threepa <- player_proj_threepm + player_proj_threep_miss
        player_proj_threepperc <- ifelse(player_proj_threepa == 0,0,round(player_proj_threepm / player_proj_threepa, digits = 3))
        player_proj_fta <- player_proj_ftm + player_proj_ft_miss
        player_proj_ftperc <- ifelse(player_proj_fta == 0,0,round(player_proj_ftm / player_proj_fta, digits = 3))
        player_proj_twopm <- player_proj_fgm - player_proj_threepm
        player_proj_twopa <- player_proj_fga - player_proj_threepa
        player_proj_twopperc <- ifelse(player_proj_twopa == 0,0,round(player_proj_twopm / player_proj_twopa, digits = 3))
        player_proj_efgperc <- ifelse(player_proj_fga == 0,0,round((player_proj_fgm + 0.5 * player_proj_threepm) / player_proj_fga,digits = 3))
        player_proj_pts <- 3 * player_proj_threepm + 2 * player_proj_twopm + 1 * player_proj_ftm
      }
      
      df.player <- data.frame(Player = player$Player,Rk = player$Rk,Pos = player$Pos,Tm = player$Tm,Season = player$Season + 1,TotalAllNba = 0,
                              Age = player$Age + 1,GP = player_proj_gp,GS = player_proj_gs,MP = player_proj_mp,FGM = player_proj_fgm,
                              FGA = player_proj_fga,FGperc = player_proj_fgperc,ThreePM = player_proj_threepm,ThreePA = player_proj_threepa,
                              ThreePperc = player_proj_threepperc,TwoPM = player_proj_twopm,TwoPA = player_proj_twopa,
                              TwoPperc = player_proj_twopperc,eFGperc = player_proj_efgperc,FTM = player_proj_ftm,FTA = player_proj_fta,
                              FTperc = player_proj_ftperc,ORB = player_proj_orb,DRB = player_proj_drb,TRB = player_proj_trb,
                              AST = player_proj_ast,STL = player_proj_stl,BLK = player_proj_blk,TOV = player_proj_tov,PF = player_proj_pf,
                              PTS = player_proj_pts,DraftYear = player$DraftYear,YearsInNba = player$YearsInNba + 1)
      if (player_proj_gp >= 48) {
        df <- rbind(df, df.player)
      }
    }
  }
  df <- df[, c(1, 2, 3, 4, 5, 33, seq(6, 32), 34)]
  return(df)
}

##################################################################
##################   Load All-NBA Awards Data   ##################
##################################################################
# load all-nba awards data from csv files downloaded from Basketball-Reference.com
loadAwardsData <- function() {
  # creating final data frame and setting variable types for the columns
  df <- data.frame(Season = integer(),Lg = character(),AllNba = logical(),TotalAllNba = integer(),ALlNbaRk = character(),Player = character(),
                   Pos = character)
  file_pth <- "all_nba_awards/all_nba_awards.csv"
  df.temp <- read.csv(file_pth, header = TRUE, stringsAsFactors = FALSE)
  # assign each player to an individual row in the dataframe
  df.temp <- melt(df.temp, id = (c("Season", "Lg", "Tm")))
  
  # want to clean format of ALl-NBA data: get season as integer,
  # all-nba team rank, split name and position into different columns
  seasons <- strsplit(as.character(df.temp$Season), "-")
  # separate name from position
  names <- strsplit(as.character(df.temp$value), " ")
  for (i in 1:dim(df.temp)[1]) {
    name <- paste(names[[i]][1], names[[i]][2])
    position <- names[[i]][3]
    season <- seasons[[i]][1]
    df.temp$Player[i] <- as.character(name)
    df.temp$Pos[i] <- as.character(position)
    df.temp$Season[i] <- as.integer(season) + 1
  }
  # fix Metta World Peace formatting and position (only case having different name format
  # from 2000-2019)
  df.temp[which(df.temp$Player == "Metta World"),]$Player <-
    "Metta World Peace"
  df.temp[which(df.temp$Player == "Metta World Peace"),]$Pos <- "F"
  
  df.temp$Season <- as.integer(df.temp$Season)
  
  # add All-NBA flag to identify players when joined together with larger Player Stats dataframe
  df.temp$TotalAllNba <- 1
  
  # rename column names
  df.temp <- data.frame(Season = df.temp$Season,LG = df.temp$Lg,TotalAllNba = df.temp$TotalAllNba,
    AllNbaRk = df.temp$Tm,
    Player = df.temp$Player,
    Pos = df.temp$Pos,
    stringsAsFactors = FALSE
  )
  
  # get seasons only from 1986 - 2019
  df.temp <- df.temp[which(df.temp$Season >= YEAR_START),]
  df <- df.temp
  
  return(df)
} 

##################################################################
################   Load Player Total Stats Data   ################
##################################################################
# load player total stats data from csv files downloaded from Basketball-Reference.com
loadTotalsData <- function(yr_start, yr_end) {
  # creating final data frame and setting variable types for the columns
  df <- data.frame(Rk = integer(),Player = character(),Pos = character(),Age = double(),Tm = character(),GP = double(),GS = double(),
                   MP = double(),FGM = double(),FGA = double(),FGperc = double(),ThreePM = double(),ThreePA = double(),ThreePperc = double(),
                   TwoPM = double(),TwoPA = double(),TwoPperc = double(),eFGperc = double(),FTM = double(),FTA = double(),FTperc = double(),
                   ORB = double(),DRB = double(),TRB = double(),AST = double(),STL = double(),BLK = double(),TOV = double(),PF = double(),
                   PTS = double(),Season = integer())
  
  # loop through each year's csv file and load data
  for (year in yr_start:yr_end) {
    file_pth <- paste("player_stats_totals/", year, ".csv", sep = "")
    df.temp <- read.csv(file_pth, header = TRUE, stringsAsFactors = FALSE)
    
    df.temp$Season <- year
    
    # rename column names
    df.temp <- data.frame(Rk = df.temp$Rk,Player = df.temp$Player,Pos = df.temp$Pos,Age = df.temp$Age,Tm = df.temp$Tm,GP = df.temp$G,
                          GS = df.temp$GS,MP = df.temp$MP,FGM = df.temp$FG,FGA = df.temp$FGA,FGperc = df.temp$FG.,ThreePM = df.temp$X3P,
                          ThreePA = df.temp$X3PA,ThreePperc = df.temp$X3P.,TwoPM = df.temp$X2P,TwoPA = df.temp$X2PA,TwoPperc = df.temp$X2P.,
                          eFGperc = df.temp$eFG.,FTM = df.temp$FT,FTA = df.temp$FTA,FTperc = df.temp$FT.,ORB = df.temp$ORB,DRB = df.temp$DRB,
                          TRB = df.temp$TRB,AST = df.temp$AST,STL = df.temp$STL,BLK = df.temp$BLK,TOV = df.temp$TOV,PF = df.temp$PF,
                          PTS = df.temp$PTS,Season = df.temp$Season,stringsAsFactors = FALSE)
    
    # combine all seasons into one large data frame
    df <- data.frame(rbind(df, df.temp))
  }
  
  df.draft <- read.csv("player_draft_year/player_draft_year.csv",header = TRUE,stringsAsFactors = FALSE)
  df.draft <- df.draft %>% distinct()
  df.draft <- df.draft[, c(2, 7)]
  # missing Ben Wallace data point
  df.draft <- rbind(df.draft, data_frame(Year = "1996", Player = "Ben Wallace\\wallabe01"))
  df.draft <- data.frame(DraftYear = df.draft$Year, Player = df.draft$Player)
  
  # remove '*' from any name
  for (i in 1:dim(df)[1]) {
    name <- df[i, ]$Player
    name <- gsub("[*]", "", name)
    df[i, ]$Player <- name
  }
  
  # merge draft year to player total stats data
  df <- merge(df, df.draft, by = c("Player"))
  df$DraftYear <- as.numeric(as.character(df$DraftYear))
  
  # reading player names from Basketball Reference csv gives format 'Chris Paul\paulch01'
  # want to clean format to just First & Last name
  df$Player <- as.character(df$Player)
  names <- strsplit(as.character(df$Player), "[\\]")
  # clean name
  for (i in 1:dim(df)[1]) {
    name <- names[[i]][1]
    df$Player[i] <- name
  }
  
  # add All NBA award winners to season
  winners <- data_all_nba[which(data_all_nba$Season >= 2000),]
  # initialize to 0
  df$TotalAllNba <- 0
  for (i in 1:dim(winners)[1]) {
    df[which(as.character(df$Player) == as.character(winners$Player[i]) & as.integer(df$Season) == winners$Season[i]),]$TotalAllNba <- 1
  }
  
  # remove TOT seasons (rows that consolidated totals for players who played for multiple teams in 1 season)
  df <- df[which(df$Tm != "TOT"),]
  df$FGperc <- ifelse(df$FTA == 0, 0, df$FGperc)
  df$ThreePperc <- ifelse(df$ThreePA == 0, 0, df$ThreePperc)
  # remove rows with missing observations
  df <- df[complete.cases(df), ]
  
  df <- df[, c(1, 2, 3, 5, 31, 32, 33, 4, seq(6, 30)),]
  
  return(df)
}
```

```{r Data Collection and Processing, message=FALSE, warning=FALSE}
YEAR_START <- 1986
YEAR_END <- 2019

# load all data in from Basketball-Reference.com
data_all_nba <- loadAwardsData()
data_player_totals <- loadTotalsData(2000, YEAR_END)
data_player_totals$YearsInNba <- data_player_totals$Season - as.integer(data_player_totals$DraftYear)

data_player_totals$AllNba <- FALSE
data_player_totals$AllNba <- ifelse(data_player_totals$TotalAllNba == 1, TRUE, FALSE)

head(data_all_nba[sample(nrow(data_all_nba), 10),], 10)
head(data_player_totals[sample(nrow(data_player_totals), 10),], 10)
```
Data was collected from the well known third-party Basketball-Reference.com. I chose to collect data from this source because of its comprehensive database of historical player, as well as the easy accesiblity (Basketball Reference allows me to download the data as CSV files). The data is well formatted and only minor processing is required. I collected data from the 1985-1986 NBA season up until the 2018-2019 season, including player total stats, player per game stats and a list of players who have been awarded an All-NBA selection. I only considered All-NBA selections from the 1999-2000 season and onwards, but collected data starting with the 1985-1986 season to account for Karl Malone's entire career (as well as all other All-NBA players career)

``` {r Data Analysis: Part 1 - Data Summary, message=FALSE, warning=FALSE}
# look at the distribution of the stats we have
cat("Player Totals Data:",dim(data_player_totals)[1],"rows by",dim(data_player_totals)[2],"columns\n")
data_player_totals %>% select(Age,GP,GS,MP,FGM,FGA,FGperc,ThreePM,ThreePA,ThreePperc,TwoPM,TwoPA,TwoPperc,eFGperc,FTM,FTA,
                              FTperc,ORB,DRB,TRB,AST,STL,BLK,PTS) %>% summary()
```
The summary statistics show a large range of values for any give statistic, as expected. I should normalize each statistic for each season. Also, note that we have 8,263 rows and 35 columns; I will check to see if we can remove some of these data points to avoid feeding noise into the model and reduce the covariates used to model the response.

``` {r Data Analysis: Part 2 - Correlation, message=FALSE, warning=FALSE}
# to determine which stats might be correlated with winning an All-NBA selection for a given season
corr.matrix.totals <- cor(data_player_totals[, c("TotalAllNba","Age","GP","GS","MP","FGM","FGA","FGperc","ThreePM","ThreePA","ThreePperc",
                                                 "TwoPM","TwoPA","TwoPperc","eFGperc","FTM","FTA","FTperc","ORB","DRB","TRB","AST","STL",
                                                 "BLK","TOV","PF","PTS")])
corrplot(corr.matrix.totals[1, 2:27, drop = FALSE],title = "Correlation: Player Totals",mar = c(0, 0, 1, 0))
```
The correlation plots of Player Total Stats show slightly positive correlation between being selected for the All-NBA team and Games Started, Field Goals Made, Field Goals Attempted, Free Throws Made, Free Throws Attempted, Rebounds, Assists, Steals, Blocks, Turnovers, and Points: stronger correlation in the scoring stats while the other counting stats are slightly less correlated. Even though we observe positive correlations with certain covariates, correlation does not necessarily imply causation. I will continue to investigate the relationship

``` {r Data Analysis: Part 3 - Distribution, message=FALSE, warning=FALSE}
# note: there might be a more efficient way to code this section, but I sacrificed ease for aesthetics since this will be generating a report
hist.totals.Age <- ggplot(data_player_totals, aes(x=Age,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.GP <- ggplot(data_player_totals, aes(x=GP,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.GS <- ggplot(data_player_totals, aes(x=GS,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.MP <- ggplot(data_player_totals, aes(x=MP,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.FGM <- ggplot(data_player_totals, aes(x=FGM,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.FGA <- ggplot(data_player_totals, aes(x=FGA,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.FGperc <- ggplot(data_player_totals, aes(x=FGperc,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.ThreePM <- ggplot(data_player_totals, aes(x=ThreePM,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.ThreePA <- ggplot(data_player_totals, aes(x=ThreePA,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.ThreePperc <- ggplot(data_player_totals, aes(x=ThreePperc,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.TwoPM <- ggplot(data_player_totals, aes(x=TwoPM,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.TwoPA <- ggplot(data_player_totals, aes(x=TwoPA,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.TwoPperc <- ggplot(data_player_totals, aes(x=TwoPperc,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.eFGperc <- ggplot(data_player_totals, aes(x=eFGperc,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.FTM <- ggplot(data_player_totals, aes(x=FTM,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.FTA <- ggplot(data_player_totals, aes(x=FTA,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.FTperc <- ggplot(data_player_totals, aes(x=FTperc,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.ORB <- ggplot(data_player_totals, aes(x=ORB,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.DRB <- ggplot(data_player_totals, aes(x=DRB,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.TRB <- ggplot(data_player_totals, aes(x=TRB,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.AST <- ggplot(data_player_totals, aes(x=AST,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.STL <- ggplot(data_player_totals, aes(x=STL,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.BLK <- ggplot(data_player_totals, aes(x=BLK,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.TOV <- ggplot(data_player_totals, aes(x=TOV,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.PF <- ggplot(data_player_totals, aes(x=PF,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.PTS <- ggplot(data_player_totals, aes(x=PTS,fill=AllNba,color=AllNba)) + 
                        geom_histogram(position = "identity", alpha = 0.5) +
                        ggtitle("Total Stats") + 
                        theme(plot.title = element_text(hjust = 0.5))
hist.totals.Age
hist.totals.GP
hist.totals.GS
hist.totals.MP
hist.totals.FGM
hist.totals.FGA
hist.totals.FGperc
hist.totals.ThreePM
hist.totals.ThreePA
hist.totals.ThreePperc
hist.totals.TwoPM
hist.totals.TwoPA
hist.totals.TwoPperc
hist.totals.eFGperc
hist.totals.FTM
hist.totals.FTA
hist.totals.FTperc
hist.totals.ORB
hist.totals.DRB
hist.totals.TRB
hist.totals.AST
hist.totals.STL
hist.totals.BLK
hist.totals.TOV
hist.totals.PF
hist.totals.PTS
```
The plots are histograms counting the number of players (y-axis) who fall into a certain bucket partitioned by each stat category (x-axis), split between All-NBA players and the rest of the league. Looking at the distribution of our data, comparing All-NBA players against the rest of the league, we uncover interesting findings that will allow me to filter out data points that could potentially dilute the model's ability to showcase elite players. I don't want to flood the model with bench/ rotational players who aren't in consideration for All-NBA honours. I will use Minutes Played during a season as a proxy, and only consider players who play 1600 minutes or more in season. I choose to use MP rather than GP as a filter because it is more restrictive, where if I filter by GP, bench/ rotational players could potentially make it through if they consistantly play throughout the season. Looking at All-NBA players, the lowest MP in a season is about 1600 minutes (the two outlier data points are players who got traded in the middle of the season and so their MP on one of the teams in low).

We consitantly see that All-NBA players are performing above average in the counting stats compared to the rest of the league - a fairly trivial solution. A more interesting discovery is the distributions of the different shooting percentages (FG%, 3P%, 2P%, eFG%, and FT%). We see that All-NBA players have similar distributions compared to the rest of the league, and are not actually shooting consistantly better or more efficiently. I infer that this comes with the territory of All-NBA players having higher usage rates and taking more shots.

``` {r Data Analysis: Part 4 - Filtering Data, message=FALSE, warning=FALSE}
# filter datapoints based on Minutes played Games Played
data_player_totals_filtered <- data_player_totals[which(data_player_totals$MP>=1600),c(1:34)]
```

```{r Data Analysis: Part 5 - Correlation of Filtered Data, message=FALSE, warning=FALSE}
# lets look at the correlation between All-NBA selections and stats for the filtered data set
corr.matrix.totals_filtered <- cor(data_player_totals_filtered[,c("TotalAllNba","Age","GP","GS","MP","FGM","FGA","FGperc","ThreePM",
                                                "ThreePA","ThreePperc","TwoPM","TwoPA","TwoPperc","eFGperc","FTM","FTA",
                                                "FTperc","ORB","DRB","TRB","AST","STL","BLK","TOV","PF","PTS")])
corrplot(corr.matrix.totals_filtered[1,2:27,drop=FALSE], title="Correlation: Player Totals", mar=c(0,0,1,0))
```
The correlation plots of show slightly stronger correlation between the different stats and being selected for the All-NBA team, better than the larger data set. What's interesting is that Turnovers has a high correlation with making an All-NBA team, but a more realistic explanation is that more Turnovers is caused by a higher usage rate, and that All-NBA players have higher usage rates.

```{r}
#####################################################
# notes: use par(mfrow=c(2,2)) to graph plots in grid: https://www.statmethods.net/advgraphs/layout.html
```

``` {r Data Analysis: Part 6- Normalize Data, message=FALSE, warning=FALSE}
# after looking at the data summaries and distribution, I normalized each statistic in each season
# by dividing it by the seasons max. This means each statistic now lies between (0,1), and the stat
# leader will now have a value of 1. This is to avoid outliers who's stats would hurt the model

# Player Stat Total
data_player_totals_normalized <- normalize_stats(data_player_totals_filtered)
```
After analyzing the data summaries and distributions, I normalized each statistic by dividing by the season's max; this means that each statistic now lies between (0,1) and the stat leader being the max at a value of 1. I do this because I don't want any outliers that are too low or too high in a certain stat category which can hurt the model.

```{r Modelling, message=FALSE, warning=FALSE}
guard_data_totals <- data_player_totals_normalized[which(data_player_totals_normalized$Pos %in% c('PG', 'SG')), ]
forward_data_totals <- data_player_totals_normalized[which(data_player_totals_normalized$Pos %in% c('SF', 'PF')), ]
center_data_totals <- data_player_totals_normalized[which(data_player_totals_normalized$Pos %in% c('C')), ]

############### linear model ###############
###############    guard     ###############
lm.guard.total.full <- lm(TotalAllNba ~ GP + GS + MP + Age + FGM + FGA + FGperc + ThreePM + ThreePA + ThreePperc + TwoPM + TwoPA + TwoPperc + 
                                        eFGperc + FTM + FTA + FTperc + ORB + DRB + TRB + AST + STL + BLK + TOV + PF + PTS,
                          data = guard_data_totals[which(guard_data_totals$Season != 2019), ])
# lm.guard.total.reduced <- step(lm.guard.total.full, trace = 0)
# summary(lm.guard.total.reduced)
lm.guard.total.reduced <- lm(TotalAllNba ~ GP + GS + MP + FGM + ThreePM + ThreePA + ThreePperc + TwoPM + TwoPA + TwoPperc + eFGperc + FTM + 
                                           FTperc + DRB + AST + STL + BLK + TOV + PF, 
                             data = guard_data_totals[which(guard_data_totals$Season != 2019), ])
lm.guard.total.full.pred <- predAllNbaPlayers(guard_data_totals[which(guard_data_totals$Season == 2019), ], lm.guard.total.reduced)[1:6, ]
lm.guard.total.red.pred <- predAllNbaPlayers(guard_data_totals[which(guard_data_totals$Season == 2019), ], lm.guard.total.reduced)[1:6, ]

############### linear model ###############
###############   forward    ###############
lm.forward.total.full <- lm(TotalAllNba ~ GP + GS + MP + Age + FGM + FGA + FGperc + ThreePM + ThreePA + ThreePperc + TwoPM + TwoPA + TwoPperc + 
                                          eFGperc + FTM + FTA + FTperc + ORB + DRB + TRB + AST + STL + BLK + TOV + PF + PTS, 
                            data = forward_data_totals[which(forward_data_totals$Season != 2019), ])
# lm.forward.total.reduced <- step(lm.forward.total.full, trace = 0)
# summary(lm.forward.total.reduced)
lm.forward.total.reduced <- lm(TotalAllNba ~ GP + MP + FGperc + ThreePperc + TwoPM + TwoPA + TwoPperc + eFGperc + FTM + FTperc + ORB + DRB +
                                             AST + STL + BLK + TOV + PTS, 
                               data = forward_data_totals[which(forward_data_totals$Season != 2019), ])
lm.forward.total.full.pred <- predAllNbaPlayers(forward_data_totals[which(forward_data_totals$Season == 2019), ], 
                                                lm.forward.total.reduced)[1:6, ]
lm.forward.total.red.pred <- predAllNbaPlayers(forward_data_totals[which(forward_data_totals$Season == 2019), ], 
                                               lm.forward.total.reduced)[1:6, ]

############### linear model ###############
###############    center    ###############
lm.center.total.full <- lm(TotalAllNba ~ GP + GS + MP + Age + FGM + FGA + FGperc + ThreePM + ThreePA + ThreePperc + TwoPM + TwoPA + TwoPperc + 
                                         eFGperc + FTM + FTA + FTperc + ORB + DRB + TRB + AST + STL + BLK + TOV + PF + PTS, 
                           data = center_data_totals[which(center_data_totals$Season != 2019), ])
# lm.center.total.reduced <- step(lm.center.total.full, trace = 0)
# summary(lm.center.total.reduced)
lm.center.total.reduced <- lm(TotalAllNba ~ GS + Age + TwoPM + TwoPA + FTM + FTA + FTperc + ORB + TRB + AST + BLK + PF,
                              data = center_data_totals[which(center_data_totals$Season != 2019), ])
lm.center.total.full.pred <- predAllNbaPlayers(center_data_totals[which(center_data_totals$Season == 2019), ], lm.center.total.reduced)[1:3, ]
lm.center.total.red.pred <- predAllNbaPlayers(center_data_totals[which(center_data_totals$Season == 2019), ], lm.center.total.reduced)[1:3, ]

############### logistic model ###############
###############     guard      ###############
log.guard.total.full <- glm(TotalAllNba ~ GP + GS + MP + Age + FGM + FGA + FGperc + ThreePM + ThreePA + ThreePperc + TwoPM + TwoPA + TwoPperc + 
                                          eFGperc + FTM + FTA + FTperc + ORB + DRB + TRB + AST + STL + BLK + TOV + PF + PTS,
                            data = guard_data_totals[which(guard_data_totals$Season != 2019), ], family = binomial(link = "logit"))
# log.guard.total.reduced <- step(log.guard.total.full, trace = 0)
# summary(log.guard.total.reduced)
log.guard.total.reduced <- glm(TotalAllNba ~ MP + FGM + FGA + TwoPA + eFGperc + FTM +DRB + AST + STL + TOV + PF + PTS,
                               data = guard_data_totals[which(guard_data_totals$Season != 2019), ],family = binomial(link = "logit"))
log.guard.total.full.pred <- predAllNbaPlayers(guard_data_totals[which(guard_data_totals$Season == 2019), ], log.guard.total.reduced)[1:6, ]
log.guard.total.red.pred <- predAllNbaPlayers(guard_data_totals[which(guard_data_totals$Season == 2019), ], log.guard.total.reduced)[1:6, ]

############### logistic model ###############
###############     forward    ###############
log.forward.total.full <- glm(TotalAllNba ~ GP + GS + MP + Age + FGM + FGA + FGperc + ThreePM + ThreePA + ThreePperc + TwoPM + TwoPA + TwoPperc +
                                            eFGperc + FTM + FTA + FTperc + ORB + DRB + TRB + AST + STL + BLK + TOV + PF + PTS, 
                              data = forward_data_totals[which(forward_data_totals$Season != 2019), ],family = binomial(link = "logit"))
# log.forward.total.reduced <- step(log.forward.total.full, trace = 0)
# summary(log.forward.total.reduced)
log.forward.total.reduced <- glm(TotalAllNba ~ MP + Age + FGperc + ThreePperc + TwoPM +eFGperc + FTM + DRB + TRB + AST + STL + 
                                               BLK + TOV + PTS,
                                 data = forward_data_totals[which(forward_data_totals$Season != 2019), ], family = binomial(link = "logit"))
log.forward.total.full.pred <- predAllNbaPlayers(forward_data_totals[which(forward_data_totals$Season == 2019), ],
                                                 log.forward.total.reduced)[1:6, ]
log.forward.total.red.pred <- predAllNbaPlayers(forward_data_totals[which(forward_data_totals$Season == 2019), ], 
                                                log.forward.total.reduced)[1:6, ]

############### logistic model ###############
###############     center     ###############
log.center.total.full <- glm(TotalAllNba ~ GP + GS + Age + FGM + FGA + FGperc + ThreePM + TwoPM + TwoPA + TwoPperc +
                                           eFGperc + FTM + ORB + DRB + AST + STL + BLK + PF,
                             data = center_data_totals[which(center_data_totals$Season != 2019), ],family = binomial(link = "logit"))
# log.center.total.reduced <- step(log.center.total.full, trace = 0)
# summary(log.center.total.reduced)
log.center.total.reduced <- glm(TotalAllNba ~ GP + Age + FGA + ThreePA + TwoPM + TwoPA + eFGperc + FTA + FTperc + TRB + AST + BLK + TOV,
                                data = center_data_totals[which(center_data_totals$Season != 2019), ],family = binomial(link = "logit"))
log.center.total.full.pred <- predAllNbaPlayers(center_data_totals[which(center_data_totals$Season == 2019), ], log.center.total.reduced)[1:3, ]
log.center.total.red.pred <- predAllNbaPlayers(center_data_totals[which(center_data_totals$Season == 2019), ], log.center.total.reduced)[1:3, ]
```
Since the All-NBA team consists for 6 guards, 6 forwards, and 3 centers, I decided to model each position seperately because the counting stats between guards, forwards, and centers differ quite significantly. I'll use the 2000-2018 data to train the model and measure the accuracy against the predictions for the 2019 season.

```{r Modeling Accuracy, message=FALSE, warning=FALSE}
# all nba team
lm.total.all_nba_team.full <- rbind(lm.guard.total.full.pred, lm.forward.total.full.pred, lm.center.total.full.pred)
lm.total.all_nba_team.red <- rbind(lm.guard.total.red.pred, lm.forward.total.red.pred, lm.center.total.red.pred)
# linear accuracy
lm.total.full.acc <- calcAccuracy(lm.total.all_nba_team.full)
lm.total.red.acc <- calcAccuracy(lm.total.all_nba_team.red)

# all nba team
log.total.all_nba_team.full <- rbind(log.guard.total.full.pred, log.forward.total.full.pred, log.center.total.full.pred)
log.total.all_nba_team.red <- rbind(log.guard.total.red.pred, log.forward.total.red.pred, log.center.total.red.pred)
# logistic accuracy
log.total.full.acc <- calcAccuracy(log.total.all_nba_team.full)
log.total.red.acc <- calcAccuracy(log.total.all_nba_team.red)

full_vs_red_acc <- data.frame(Data = c("Full Model", "Reduced Model", "Full Model", "Reduced Model"),
                              Linear = c(lm.total.full.acc, lm.total.red.acc),
                              Logistic = c(log.total.full.acc, log.total.red.acc))
par(mfrow = c(1, 1))
colours <- viridis(2)
full_vs_red_plot <- barplot(c(full_vs_red_acc$Linear[1],full_vs_red_acc$Linear[2],full_vs_red_acc$Logistic[1],full_vs_red_acc$Logistic[2]),
                            names.arg = full_vs_red_acc$Data,ylim = c(0, 1),las = 2,col = c(rep(colours[1], 2), rep(colours[2], 2)),
                            ylab = "Accuracy", main = "Player Total Stats - 2019 Predictions", cex.names = 0.6)
text(x = full_vs_red_plot,y = c(full_vs_red_acc$Linear[1],full_vs_red_acc$Linear[2],full_vs_red_acc$Logistic[1],full_vs_red_acc$Logistic[2]),
     label = round(c(full_vs_red_acc$Linear[1],full_vs_red_acc$Linear[2],full_vs_red_acc$Logistic[1],full_vs_red_acc$Logistic[2]),digits = 3),
     pos = 3,cex = 0.7)
legend("bottomright", c("Linear Model", "Logistic Model"), fill = colours, cex = 0.8)
```
I predicted the 2019 All-NBA team by first predicting the All-NBA guards, forwards, and centers seperately, and then combining the results to form the All-NBA team. The Logistic Model with Player Total Stats Data correctly predicted 93.3% of the 2019 All-NBA team, or 14/15 players. We see that the reduced models with less covariates perform the same as the full models so I will use the reduced models going forward. With the simpler models, I will perform cross validation to see which model performs the best. With the 2000-2019 data, I will test the model accuracy by using all the years, except for 1, to train the model and predict All-NBA players for the 1 season left out of the training data set, and do so for each and every year.

```{r Cross Validation, message=FALSE, warning=FALSE}
lm.guard.total.accuracies <- mean(cross_validation_all_nba_players(guard_data_totals, lm.guard.total.reduced, "guard"))
lm.forward.total.accuracies <- mean(cross_validation_all_nba_players(forward_data_totals, lm.forward.total.reduced, "forward"))
lm.center.total.accuracies <- mean(cross_validation_all_nba_players(center_data_totals, lm.center.total.reduced, "center"))
log.guard.total.accuracies <- mean(cross_validation_all_nba_players(guard_data_totals, log.guard.total.reduced, "guard"))
log.forward.total.accuracies <- mean(cross_validation_all_nba_players(forward_data_totals, log.forward.total.reduced, "forward"))
log.center.total.accuracies <- mean(cross_validation_all_nba_players(center_data_totals, log.center.total.reduced, "center"))

linear_vs_log <- data.frame(Linear = c(lm.guard.total.accuracies,lm.forward.total.accuracies,lm.center.total.accuracies),
                            Logistic = c(log.guard.total.accuracies,log.forward.total.accuracies,log.center.total.accuracies))
par(mfrow = c(1, 1))
colours <- viridis(3)
full_vs_red_plot <- barplot(c(linear_vs_log$Linear[1],linear_vs_log$Logistic[1],linear_vs_log$Linear[2],linear_vs_log$Logistic[2],
                              linear_vs_log$Linear[3],linear_vs_log$Logistic[3]),
                            names.arg = rep(c("LM - Total", "Log - Total"), 3),ylim = c(0, 1),las = 2,
                            col = c(rep(colours[1], 2), rep(colours[2], 2), rep(colours[3], 2)),ylab = "Accuracy",
                            main = "Linear vs Logistic Model Accuracy - LOOCV",cex.names = 0.6)
text(x = full_vs_red_plot,y = c(linear_vs_log$Linear[1],linear_vs_log$Logistic[1],linear_vs_log$Linear[2],linear_vs_log$Logistic[2],
                                linear_vs_log$Linear[3],linear_vs_log$Logistic[3]),
     label = round(c(linear_vs_log$Linear[1],linear_vs_log$Logistic[1],linear_vs_log$Linear[2],linear_vs_log$Logistic[2],
                     linear_vs_log$Linear[3],linear_vs_log$Logistic[3]),digits = 3),
     pos = 3,cex = 0.7)
legend("bottomright", c("Guards", "Forwards", "Centers"), fill = colours, cex = 0.8)
```
I predicted the All-NBA guards, forwards, and centers seperately for each year, and then took the average of the model's accuracy respectively. The Logisitc models out performed the Linear models for each position, with the Guard's model accurately predicting the All-NBA guards 79.2% of the time, the Forwards's model accurately predicting the All-NBA forwards 76.7% of the time, and the Center's model accurately predicting the All-NBA centers 75% of the time, for each season between 2000-2019. I'll continue with the Logistic model's for each position going forward.


To get the predictions for Luka Doncic, Kyrie Irving, and Stephen Curry I will use the Reduced Logistic Model for guards and the Reduced Logistic Model for centers for Karl-Anthony Towns. First, I have to project the player's stats for the rest of their career, and doing so I make a couple assumptions: 
1) I will assume that players don't have a career longer than 17 years, which is based on the careers of players like Kobe, Shaq, Lebron, and Tim Duncan
2) I project a players GP, GS, and MP based on their prior seasons GP, GS, and MP, but add normalized noise with a variance of 4 games
3) Stat projections are based on a weighted average of the players past 3 seasons played, the minutes they played during each season, and scaled by the league average in each category per minute. Then the projected stat per minute is multipled by the projected MP by that player to get their total
The algorithm is based off a similar method used by Basketball-Reference.com
```{r Prediction, message=FALSE, warning=FALSE}
# get the predictions for Luka Doncic, Karl Anthony-Towns, Kyrie Irving, Stephen Curry and make the predictions
# I make quite a few assumptions to answer the question at hand: the average career length for an All-NBA player,
# assume that each player will continue to perform at the same caliber as last season for the rest of their career,
# and that the number of All-NBA selections for any given player at any point in their NBA career follows a 
# Binomial distribution with parameters n = # remaining seasons and p = probability of making All-NBA team last season

# this simulates the stats for NBA players over the next 15 seasons
set.seed(1)
df.forecast <- simulate_all_nba(data_player_totals_filtered)

# Total number of All-NBA selections remaining in each of player's career
luka <- dim(df.forecast[which(df.forecast$Player=="Luka Doni"&df.forecast$TotalAllNba==1&df.forecast$Season>=2020),])[1]
kyrie <- dim(df.forecast[which(df.forecast$Player=="Kyrie Irving"&df.forecast$TotalAllNba==1&df.forecast$Season>=2020),])[1]
steph <- dim(df.forecast[which(df.forecast$Player=="Stephen Curry"&df.forecast$TotalAllNba==1&df.forecast$Season>=2020),])[1]
kat <- dim(df.forecast[which(df.forecast$Player=="Karl-Anthony Towns"&df.forecast$TotalAllNba==1&df.forecast$Season>=2020),])[1]

print(paste("I predict that Luka Doncic will receive ",luka," All-NBA selections for the remainder of his carrer, Kyrie Irving ",kyrie,
            ", Steph Curry ",steph,", and Karl-Anthony Towns ",kat,"."))
```


```{r Simulation, message=FALSE, warning=FALSE}
seeds <- sample(1:10,10)
# seeds <- c(1,2)
luka_most <- 0
kyrie_most <- 0
steph_most <- 0
kat_most <- 0
sim_results <- data.frame(Seed=integer(),Luka=integer(),Kyrie=integer(),Steph=integer(),Kat=integer())
for (i in seeds) {
  set.seed(i)
  df.forecast <- simulate_all_nba(data_player_totals_filtered)
  luka <- dim(df.forecast[which(df.forecast$Player=="Luka Doni"&df.forecast$TotalAllNba==1&df.forecast$Season>=2020),])[1]
  kyrie <- dim(df.forecast[which(df.forecast$Player=="Kyrie Irving"&df.forecast$TotalAllNba==1&df.forecast$Season>=2020),])[1]
  steph <- dim(df.forecast[which(df.forecast$Player=="Stephen Curry"&df.forecast$TotalAllNba==1&df.forecast$Season>=2020),])[1]
  kat <- dim(df.forecast[which(df.forecast$Player=="Karl-Anthony Towns"&df.forecast$TotalAllNba==1&df.forecast$Season>=2020),])[1]
  
  if (luka>kyrie&luka>steph&luka>kat) {
    luka_most = luka_most + 1
  } else if (kyrie>luka&kyrie>steph&kyrie>kat) {
    kyrie_most = kyrie_most + 1
  } else if (steph>luka&steph>kyrie&steph>kat) {
    steph_most = steph_most + 1
  } else if (kat>luka&kat>kyrie&kat>steph) {
    kat_most = kat_most + 1
  } else {
    if (luka==max(luka,kyrie,steph,kat)) {
      luka_most = luka_most + 1
    }
    if (kyrie==max(luka,kyrie,steph,kat)) {
      kyrie_most = kyrie_most + 1
    }
    if (steph==max(luka,kyrie,steph,kat)) {
      steph_most = steph_most + 1
    }
    if (kat==max(luka,kyrie,steph,kat)) {
      kat_most = kat_most + 1
    }
  }
  sim_results <- rbind(sim_results,data.frame(Seed=i,Luka=luka,Kyrie=kyrie,Steph=steph,Kat=kat))
}
luka_likelihood <- luka_most / length(seeds)
kyrie_likelihood <- kyrie_most / length(seeds)
steph_likelihood <- steph_most / length(seeds)
kat_likelihood <- kat_most / length(seeds)

luka_est <- mean(sim_results$Luka)
kyrie_est <- mean(sim_results$Kyrie)
steph_est <- mean(sim_results$Steph)
kat_est <- mean(sim_results$Kat)

print(paste("The likelihood that Doncic will have the greatest number of All-NBA selections remaining among the group is: ",luka_likelihood,", Kyrie Irving: ",kyrie_likelihood,
            ", Steph Curry: ",steph_likelihood,", Karl-Anthony Towns: ",kat_likelihood, sep = ""))
print(paste("The average number of All-NBA selections for Luka Doncic out of ",length(seeds)," simulation(s) is ",luka_est,
            ", Kyrie Irving: ",kyrie_est,", Steph Curry: ",steph_est,", and Karl-Anthony Towns: ",kat_est,sep = ""))
# The likelihood that Doncic will have the greatest number of All-NBA selections remaining among the group is: 0.5, Kyrie Irving: 0, Steph Curry: 0, Karl-Anthony Towns: 0.6
# The average number of All-NBA selections for Luka Doncic out of 10 simulation(s) is 7.7, Kyrie Irving: 1.5, Steph Curry: 0.3, and Karl-Anthony Towns: 8.1"
```

```{r Further Considerations}
```


``` {r }
```